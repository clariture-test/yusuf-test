var options={call:null,last_row:null,selected:{hash:{},length:0,is_selected:function(a){return a in this.hash},add:function(a){this.is_selected(a.id)||(this.hash[a.id]=a,this.length++)},remove:function(a){this.is_selected(a.id)&&(delete this.hash[a.id],this.length--)},sort:function(){var a=[],b;for(b in this.hash)a.push(this.hash[b]);a.sort(function(a,b){return a.id>b.id?1:-1});return a},list:function(){return $.map(this.hash,function(a){return a.id})},clear:function(){this.hash={};this.length=0}},
_update_select_count:function(){$("#select_count").text(this.selected.length.toString())},_select:function(a){$(a).addClass("highlight");this.selected.add(a);this._update_select_count()},_deselect:function(a){$(a).removeClass("highlight");this.selected.remove(a);this._update_select_count()},select:function(a){this.selected.is_selected(a.id)||this._select(a)},deselect:function(a){this.selected.is_selected(a.id)&&this._deselect(a)},get_range:function(a){return a.rowIndex>this.last_row.rowIndex?{first:this.last_row,
last:a}:{first:a,last:this.last_row}},select_range:function(a){if(this.last_row){var b=this;a=this.get_range(a);$("table.multiselect tr").slice(a.first.rowIndex,a.last.rowIndex).each(function(){b.select(this)});this.select(a.last)}else this.select(a)},deselect_range:function(a){if(this.last_row){var b=this;a=this.get_range(a);$("table.multiselect tr").slice(a.first.rowIndex,a.last.rowIndex).each(function(){b.deselect(this)});this.deselect(a.last)}else this.deselect(a)},click:function(a){a.className?
this.deselect(a):this.select(a);this.last_row=a},shift_click:function(a){a.className?this.deselect_range(a):this.select_range(a);this.last_row=a},update:function(a){var b=this;a=a||"";this.call&&this.call.abort();this.call=$.get("/devices/"+device_type+"/?search="+a,function(a){b.call=null;$("#options").html(a);for(name in b.selected.hash)$(document.getElementById(name)).addClass("highlight")})},submit:function(a){var b=$("#select_form");if(this.selected.length){for(name in this.selected.hash)b.append('<input type="hidden" name="option_list" value="'+
name+'" />');$("#action").val(a);b.submit()}else $("#select_one").dialog({modal:!0})},show_selected:function(){var a=this.selected.sort();table=$('<table class="multiselect"></table>');for(i=0;i<a.length;i++)table.append($(a[i]));$("#options").html(table);$("#search").val("");$("#search").focus()},clear_all:function(){this.selected.clear();$("table.multiselect tr.highlight").removeClass("highlight");$("#select_count").text("0");$("#search").focus()},bulk_select:function(a){var b=this,c=[];$.each(a.split(/\W+/),
function(a,d){if(d){var e=d.toUpperCase();(row=document.getElementById(e))?b.select(row):c.push(e)}});return c},initialize:function(){var a=this;$("#search").keyup(function(b){16!=b.keyCode&&a.update($(this).val())});$(document).on("click","table.multiselect tr",function(b){b.shiftKey?a.shift_click(this):a.click(this);$("#search").focus()});$("#search").focus()}};
